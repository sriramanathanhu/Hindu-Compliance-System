# Implementation Plan: Hindu Compliance Website UI Design

**Branch**: `001-hindu-compliance-website` | **Date**: 2025-10-07 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/001-hindu-compliance-website/spec.md`

**Note**: This plan is generated by the `/speckit.plan` command.

## Summary

Build a modern, responsive Next.js frontend for a Hindu temple compliance management system that integrates with Payload CMS for content management and Nandi SSO for authentication. The application will feature a BBB-inspired design with homepage sections for search, featured content, business services, testimonials, and comprehensive compliance management workflows including dashboard, form submission, status tracking, and notifications.

## Technical Context

**Language/Version**: JavaScript/TypeScript with Node.js 18+ (Next.js 14+)
**Primary Dependencies**:
- Next.js 14+ (React 18+)
- Payload CMS Client SDK
- Nandi SSO OAuth 2.0 client
- Tailwind CSS (for responsive design)
- React Hook Form (form management)
- Axios/Fetch API (Payload CMS integration)
- NextAuth.js or custom OAuth handler (Nandi SSO)

**Storage**:
- Client-side: LocalStorage/SessionStorage for form auto-save
- Server-side: Payload CMS (external backend API)
- File uploads: Handled by Payload CMS file API

**Testing**:
- Jest + React Testing Library (unit/integration)
- Playwright (E2E testing)
- Accessibility testing (axe-core for WCAG 2.1 AAA)

**Target Platform**:
- Web browsers (Chrome, Firefox, Safari, Edge - last 2 versions)
- Desktop (primary), Tablet, Mobile (responsive)
- SSR/SSG via Next.js deployment (Vercel/self-hosted)

**Project Type**: Web application (Next.js frontend with external CMS backend)

**Performance Goals**:
- Initial page load: <2 seconds (dashboard)
- Form pages: <3 seconds
- API response handling: <500ms UI feedback
- Support 500 concurrent users
- Lighthouse score: >90 (Performance, Accessibility, Best Practices)

**Constraints**:
- WCAG 2.1 Level AAA compliance (accessibility)
- OAuth 2.0 flow latency: <1 second for auth redirect
- Form auto-save: Every 30 seconds or on field blur
- File upload: 10MB max per file, progress indicators required
- Mobile usability: Touch targets ≥44x44px, readable text ≥16px

**Scale/Scope**:
- Initial: Homepage + Dashboard + 2-3 compliance forms
- Phase 2: Full form library, advanced tracking, notifications
- Expected users: 500-1000 temple administrators
- Content: ~50-100 CMS-managed content blocks
- Forms: 10-15 unique compliance form types

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

**Status**: ✅ PASSED (Constitution template not customized - using framework defaults)

Since the project constitution is not yet customized from template, we proceed with standard best practices:
- Component-based architecture (Next.js/React standard)
- API-first integration (Payload CMS REST/GraphQL)
- OAuth 2.0 standard flow (Nandi SSO)
- WCAG 2.1 AAA compliance (specified requirement)
- Test coverage requirements (TBD in tasks phase)

**Note**: Project-specific constitution should be established for long-term governance.

## Project Structure

### Documentation (this feature)

```
specs/001-hindu-compliance-website/
├── plan.md              # This file
├── research.md          # Phase 0: Technology decisions and patterns
├── data-model.md        # Phase 1: Content models and data entities
├── quickstart.md        # Phase 1: Developer setup guide
├── contracts/           # Phase 1: API contracts and interfaces
│   ├── payload-cms.yaml # Payload CMS API contract
│   └── nandi-sso.yaml   # Nandi SSO OAuth contract (reference: /root/hinducs/nandi-authentication-api.yaml)
└── tasks.md             # Phase 2: Implementation tasks (via /speckit.tasks)
```

### Source Code (repository root)

```
hindu-compliance-website/          # Next.js project root
├── public/                        # Static assets
│   ├── images/                    # BBB-inspired design assets
│   └── icons/                     # UI icons
│
├── src/
│   ├── app/                       # Next.js 14 App Router
│   │   ├── (auth)/                # Auth routes group
│   │   │   ├── signin/
│   │   │   ├── callback/          # OAuth callback
│   │   │   └── signout/
│   │   ├── (public)/              # Public routes group
│   │   │   ├── page.tsx           # Homepage
│   │   │   └── layout.tsx         # Public layout
│   │   ├── (dashboard)/           # Protected routes group
│   │   │   ├── dashboard/
│   │   │   ├── submissions/
│   │   │   ├── forms/
│   │   │   ├── compliance/
│   │   │   └── layout.tsx         # Dashboard layout
│   │   ├── api/                   # API routes
│   │   │   ├── auth/              # Auth endpoints
│   │   │   ├── cms/               # Payload CMS proxy
│   │   │   └── submissions/       # Form submissions
│   │   └── layout.tsx             # Root layout
│   │
│   ├── components/                # Reusable components
│   │   ├── layout/
│   │   │   ├── Header.tsx
│   │   │   ├── Footer.tsx
│   │   │   ├── Navigation.tsx
│   │   │   └── LocationSelector.tsx
│   │   ├── homepage/
│   │   │   ├── HeroSection.tsx
│   │   │   ├── SearchBar.tsx
│   │   │   ├── FeaturedContent.tsx
│   │   │   ├── BusinessServices.tsx
│   │   │   └── Testimonials.tsx
│   │   ├── dashboard/
│   │   │   ├── ComplianceStatus.tsx
│   │   │   ├── TaskList.tsx
│   │   │   ├── AlertsPanel.tsx
│   │   │   └── ActivityTimeline.tsx
│   │   ├── forms/
│   │   │   ├── ComplianceForm.tsx
│   │   │   ├── FileUpload.tsx
│   │   │   ├── FormField.tsx
│   │   │   └── ValidationMessage.tsx
│   │   ├── submissions/
│   │   │   ├── SubmissionList.tsx
│   │   │   ├── StatusBadge.tsx
│   │   │   └── FilterPanel.tsx
│   │   └── ui/
│   │       ├── Button.tsx
│   │       ├── Input.tsx
│   │       ├── Modal.tsx
│   │       ├── Tooltip.tsx
│   │       └── Notification.tsx
│   │
│   ├── lib/                       # Utility libraries
│   │   ├── auth/
│   │   │   ├── nandi-sso.ts       # Nandi SSO OAuth client
│   │   │   ├── session.ts         # Session management
│   │   │   └── middleware.ts      # Auth middleware
│   │   ├── cms/
│   │   │   ├── payload-client.ts  # Payload CMS API client
│   │   │   ├── content-types.ts   # CMS content type definitions
│   │   │   └── cache.ts           # Content caching
│   │   ├── forms/
│   │   │   ├── validation.ts      # Form validation rules
│   │   │   ├── auto-save.ts       # Form auto-save logic
│   │   │   └── file-upload.ts     # File upload utilities
│   │   └── utils/
│   │       ├── api.ts             # API client helpers
│   │       ├── date.ts            # Date formatting
│   │       └── accessibility.ts   # A11y utilities
│   │
│   ├── hooks/                     # Custom React hooks
│   │   ├── useAuth.ts             # Authentication hook
│   │   ├── useCMS.ts              # CMS data fetching
│   │   ├── useForm.ts             # Form management
│   │   └── useAutoSave.ts         # Auto-save functionality
│   │
│   ├── types/                     # TypeScript definitions
│   │   ├── auth.ts                # Auth types
│   │   ├── cms.ts                 # CMS content types
│   │   ├── compliance.ts          # Compliance entities
│   │   └── api.ts                 # API response types
│   │
│   ├── styles/                    # Global styles
│   │   ├── globals.css            # Global CSS + Tailwind
│   │   └── themes.css             # Theme variables
│   │
│   └── middleware.ts              # Next.js middleware (auth)
│
├── tests/
│   ├── unit/                      # Unit tests
│   │   ├── components/
│   │   ├── lib/
│   │   └── hooks/
│   ├── integration/               # Integration tests
│   │   ├── auth-flow.test.ts
│   │   ├── cms-integration.test.ts
│   │   └── form-submission.test.ts
│   ├── e2e/                       # E2E tests (Playwright)
│   │   ├── homepage.spec.ts
│   │   ├── auth.spec.ts
│   │   ├── dashboard.spec.ts
│   │   └── compliance-forms.spec.ts
│   └── accessibility/             # A11y tests
│       └── wcag-compliance.test.ts
│
├── .env.example                   # Environment variables template
├── .env.local                     # Local environment (gitignored)
├── next.config.js                 # Next.js configuration
├── tailwind.config.js             # Tailwind configuration
├── tsconfig.json                  # TypeScript configuration
├── playwright.config.ts           # Playwright configuration
├── jest.config.js                 # Jest configuration
└── package.json                   # Dependencies

```

**Structure Decision**: Web application structure chosen because:
- Next.js App Router provides modern SSR/SSG capabilities
- Separate `(auth)`, `(public)`, `(dashboard)` route groups for clean layout organization
- Component-based architecture aligns with React best practices
- Integration layer (`lib/`) separates external service logic from UI
- Comprehensive testing structure supports unit, integration, E2E, and accessibility testing

## Complexity Tracking

*No constitution violations - proceeding with standard web application architecture.*

| Aspect | Justification |
|--------|---------------|
| Next.js App Router | Modern routing with nested layouts, required for complex auth flows and dashboard organization |
| External CMS Integration | Payload CMS requirement from spec - enables content management without code deployment |
| OAuth 2.0 Custom Implementation | Nandi SSO not a standard OAuth provider - requires custom client implementation following `nandi-authentication-api.yaml` |
| WCAG 2.1 AAA Compliance | Spec requirement - necessitates comprehensive accessibility testing and semantic HTML |

## Phase 0: Research & Technology Decisions

**Status**: Ready to generate `research.md`

### Research Topics

1. **Next.js 14 App Router Best Practices**
   - Server vs Client Components
   - Route Groups and Layout Composition
   - Middleware for authentication
   - SEO optimization for compliance website

2. **Payload CMS Integration Patterns**
   - REST vs GraphQL client
   - Content caching strategies
   - Dynamic routing from CMS slugs
   - Image optimization with CMS assets

3. **Nandi SSO OAuth 2.0 Implementation**
   - OAuth flow: authorization code grant
   - Token storage (cookies vs localStorage)
   - Session management and refresh
   - PKCE (if supported by Nandi)

4. **BBB Design Pattern Adaptation**
   - Hero section with search functionality
   - Card-based content layouts
   - Responsive navigation patterns
   - Color scheme and typography

5. **Form Management & Auto-Save**
   - React Hook Form integration
   - Auto-save implementation strategies
   - File upload with progress tracking
   - Form state persistence on session timeout

6. **WCAG 2.1 AAA Compliance**
   - Semantic HTML requirements
   - ARIA labels and roles
   - Keyboard navigation patterns
   - Screen reader testing approach
   - Color contrast requirements (Level AAA)

7. **Testing Strategy**
   - Jest + React Testing Library setup
   - Playwright for E2E testing
   - axe-core accessibility testing
   - Mock strategies for Payload CMS and Nandi SSO

### Unknowns to Resolve

- [ ] Payload CMS specific API endpoint structure and authentication
- [ ] Nandi SSO token expiration and refresh token handling
- [ ] BBB design asset licensing and adaptation permissions
- [ ] Specific Tailwind configuration for BBB-inspired theme
- [ ] Next.js hosting environment (Vercel vs self-hosted)
- [ ] Environment variable management for multi-environment deployment

## Phase 1: Design & Contracts

**Prerequisites**: `research.md` complete with all unknowns resolved

### Deliverables

1. **data-model.md**: Content models and data entities
   - Temple Profile entity structure
   - Compliance Submission entity
   - Compliance Requirement entity
   - User/Administrator entity
   - Notification entity
   - Document Attachment entity
   - CMS content types (Homepage, Featured Content, Testimonials)

2. **contracts/** directory:
   - `payload-cms.yaml`: Payload CMS REST/GraphQL API contract
   - `nandi-sso.yaml`: Reference to `/root/hinducs/nandi-authentication-api.yaml`
   - `compliance-api.yaml`: Future backend API contract (if separate from Payload)

3. **quickstart.md**: Developer setup guide
   - Prerequisites (Node.js, npm/yarn)
   - Environment setup (.env configuration)
   - Payload CMS connection setup
   - Nandi SSO OAuth credentials
   - Running development server
   - Running tests
   - UI design screenshot reference

## Phase 2: Task Breakdown

**Prerequisites**: Phase 1 complete

**Note**: This phase is executed via `/speckit.tasks` command (not `/speckit.plan`).

Expected task categories:
- Environment setup and project initialization
- Component development (homepage, dashboard, forms)
- Payload CMS integration
- Nandi SSO authentication implementation
- Form management and auto-save
- Testing setup and test coverage
- Accessibility compliance verification
- Responsive design implementation
- Deployment configuration

## Key Design Decisions

### Authentication Flow

```
User → Click Sign In → Redirect to auth.kailasa.ai/auth/sign-in
     → User authenticates → Nandi redirects back with code
     → Next.js API route exchanges code for token
     → Store session (httpOnly cookie)
     → Redirect to dashboard
```

### Content Management Strategy

- **Static Content**: Build-time fetch from Payload CMS (ISR with revalidation)
- **Dynamic Content**: Client-side fetch for user-specific data (submissions, dashboard)
- **Caching**: Next.js cache + React Query for client-side caching

### Form Auto-Save Implementation

- Debounced auto-save every 30 seconds
- Save on field blur events
- localStorage backup before session expiration
- Restore on re-authentication

### Responsive Design Approach

- Mobile-first CSS with Tailwind breakpoints
- BBB design patterns adapted for smaller screens
- Progressive enhancement for complex forms
- Touch-optimized UI components

## Dependencies & Integration Points

### External Services

1. **Nandi SSO (auth.kailasa.ai)**
   - OAuth 2.0 authorization endpoint
   - Token exchange endpoint
   - Session validation endpoint
   - User info endpoint

2. **Payload CMS**
   - Content API (REST/GraphQL)
   - File upload API
   - Admin UI (for content management)

### Development Dependencies

- Reference: `/root/hinducs/nandi-auth-examples-main/` for OAuth implementation
- Reference: `/root/hinducs/nandi-authentication-api.yaml` for API contract
- Reference: `/root/hinducs/ui_design_screenshots/` for UI design mockups

### Environment Variables Required

```
# Nandi SSO
NANDI_SSO_CLIENT_ID=
NANDI_SSO_CLIENT_SECRET=
NANDI_SSO_REDIRECT_URI=
NANDI_SSO_AUTH_URL=https://auth.kailasa.ai

# Payload CMS
PAYLOAD_API_URL=
PAYLOAD_API_KEY=

# Next.js
NEXT_PUBLIC_APP_URL=
NODE_ENV=

# Optional
EMAIL_SERVICE_API_KEY=
FILE_STORAGE_BUCKET=
```

## Risk Assessment

| Risk | Impact | Mitigation |
|------|--------|------------|
| Nandi SSO integration complexity | HIGH | Study `nandi-auth-examples-main`, implement with extensive testing |
| WCAG 2.1 AAA compliance | HIGH | Early accessibility audits, use semantic HTML, comprehensive testing |
| Payload CMS API structure unknown | MEDIUM | Phase 0 research, document API contract in contracts/ |
| Form auto-save complexity | MEDIUM | Use proven libraries (React Hook Form), implement incremental backups |
| BBB design adaptation | LOW | Reference screenshots, use component libraries |

## Success Criteria Alignment

This implementation plan supports all 15 success criteria from the specification:
- **SC-001 to SC-007**: UI/UX performance through Next.js optimization
- **SC-008**: Horizontal scaling via stateless architecture
- **SC-009**: Auto-save implementation prevents data loss
- **SC-010 to SC-013**: User experience through intuitive design
- **SC-014 to SC-015**: WCAG 2.1 AAA compliance and accessibility testing

## Next Steps

1. **Generate research.md**: Research all unknowns and document technology decisions
2. **Generate data-model.md**: Define all entities and CMS content models
3. **Create contracts/**: Document Payload CMS and Nandi SSO API contracts
4. **Generate quickstart.md**: Developer onboarding guide
5. **Update agent context**: Add Next.js, Payload CMS, Nandi SSO to agent knowledge
6. **Proceed to /speckit.tasks**: Generate detailed implementation tasks

---

**Plan Status**: ✅ Phase 0 & 1 outlined, ready for artifact generation
**Last Updated**: 2025-10-07
